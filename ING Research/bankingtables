CREATE TABLE IF NOT EXISTS bankaccounts (
    IBAN VARCHAR PRIMARY KEY NOT NULL,
    balance NUMERIC DEFAULT 0,
    customer_BSN VARCHAR NOT NULL,
    FOREIGN KEY(customer_BSN) REFERENCES customeraccounts(customer_BSN)
);

CREATE TABLE IF NOT EXISTS customeraccounts (
    customer_BSN VARCHAR PRIMARY KEY NOT NULL,
    name VARCHAR NOT NULL,
    surname VARCHAR NOT NULL,
    street_address VARCHAR NOT NULL,
    email VARCHAR NOT NULL,
    phone_number VARCHAR NOT NULL,
    birth_date VARCHAR NOT NULL
);

CREATE TABLE IF NOT EXISTS customerbankaccounts (
    customer_BSN VARCHAR NOT NULL,
    IBAN VARCHAR NOT NULL,
    FOREIGN KEY(customer_BSN) REFERENCES customeraccounts(customer_BSN),
    FOREIGN KEY(IBAN) REFERENCES bankaccounts(IBAN),
    PRIMARY KEY(customer_BSN, IBAN)
);

CREATE TABLE IF NOT EXISTS transactions (
    source_IBAN VARCHAR NOT NULL,
    destination_IBAN VARCHAR,
    date_time DATETIME NOT NULL,
    amount NUMERIC NOT NULL,
    description VARCHAR NOT NULL,
    FOREIGN KEY (source_IBAN) REFERENCES bankaccounts(IBAN),
    FOREIGN KEY (destination_IBAN) REFERENCES bankaccounts(IBAN),
    PRIMARY KEY (source_IBAN, destination_IBAN, date_time)
);

CREATE TABLE IF NOT EXISTS debitcards (
	customer_BSN VARCHAR NOT NULL,
	bankaccount_IBAN VARCHAR NOT NULL,
	PIN CHAR(4) NOT NULL,
	card_number VARCHAR UNIQUE NOT NULL,
	expiration_date VARCHAR NOT NULL,
	FOREIGN KEY (customer_BSN) REFERENCES customeraccounts(customer_BSN),
	FOREIGN KEY (bankaccount_IBAN) REFERENCES bankaccounts(IBAN),
    PRIMARY KEY (card_number)
);